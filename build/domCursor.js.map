{
  "version": 3,
  "file": "domCursor.js",
  "sourceRoot": "..",
  "sources": [
    "domCursor.litcoffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "DOMCursor\n=========\nCopyright (C) 2014, Bill Burdick, Roy Riggs, TEAM CTHULHU\n\nLicensed with ZLIB license (see \"License\", below).\n\nFiltered cursoring on DOM trees.  DOMCursors can move forwards or backwards, by node or by character, with settable filters that can seamlessly skip over parts of the DOM.\n\nThis readme file is also the code.\n\nHere are some examples (I'm wrapping them in a -> to make a no-op that gets syntax highlighting in viewers that support it).\n\n    ->\n\nIn Leisure, I use it like this, to retrieve text from the page (scroll down to see docs on these methods, by the way):\n\n      DOMCursor.prototype.filterOrg = ->\n        @addFilter (n)-> !n.hasAttribute('data-nonorg') || 'skip'\n\n      domCursor = (node, pos)-> new DOMCursor(node, pos).filterOrg()\n\n      # full text for node\n      getOrgText = (node)->\n        domCursor node.firstChild, 0\n          .mutable()\n          .filterTextNodes()\n          .filterParent node\n          .getText()\n\nAnd like this for cursor movement.  Once I have the cursor, I can use forwardChar, backwardChar, forwardLine, backwardLine to move it around:\n\n      domCursorForCaret = (end)->\n        sel = getSelection()\n        c = if sel.type == 'None' then emptyDOMCursor\n        else if end then domCursor sel.extentNode, sel.extendOffset\n        else domCursor sel.anchorNode, sel.anchorOffset\n        if !c.empty\n          parent = parentForNode sel.focusNode\n          c = c\n            .mutable()\n            .filterVisibleTextNodes()\n            .filterParent parent\n            .firstText()\n          if c.pos < c.node.length then c else c.next()\n        c\n\nDOMCursor Class\n---------------\n\nDOMCursors are immutable -- operations on them return new DOMCursers.\nThere are two ways to get mutabile cursors, sending @mutable() or\nsending @withMutations (m)-> ...\n\nA DOMCursor has a node, a position, a filter, and a type.\n\n- node: like with ranges, a DOM node\n- position: like with ranges, either the index of a child, for elements, or the index of a character, for text nodes.\n- filter: a function used by @next() and @prev() to skip over portions of DOM. It returns\n  - truthy: to accept a node but its children are still filtered\n  - falsey: to reject a node but its children are still filtered\n  - 'skip': to skip a node and its children\n  - 'quit': to end to make @next() or @prev() return an empty DOMCursor\n- type: 'empty', 'text', or 'element'\n\nLicense\n=====================\nLicensed with ZLIB license.\n\nThis software is provided 'as-is', without any express or implied\nwarranty. In no event will the authors be held liable for any damages\narising from the use of this software.\n\nPermission is granted to anyone to use this software for any purpose,\nincluding commercial applications, and to alter it and redistribute it\nfreely, subject to the following restrictions:\n\n1. The origin of this software must not be misrepresented; you must not\nclaim that you wrote the original software. If you use this software\nin a product, an acknowledgment in the product documentation would be\nappreciated but is not required.\n\n2. Altered source versions must be plainly marked as such, and must not be\nmisrepresented as being the original software.\n\n3. This notice may not be removed or altered from any source distribution.\n\nThe DOMCursor class...\n======================\n\n    export class DOMCursor\n      constructor: (@node, @pos, filter)->\n        if @node instanceof Range\n          filter = @pos\n          @pos = @node.startOffset\n          @node = @node.startContainer\n        @pos = @pos ? 0\n        @filter = filter || -> true\n        @computeType()\n        @savedTextPosition = null\n\n      isCollapsed: -> !@isEmpty() && isCollapsed @node\n\n      computeType: ->\n        @type = if !@node then 'empty'\n        else if @node.nodeType == @node.TEXT_NODE then 'text'\n        else 'element'\n        this\n\n      equals: (other)-> @node == other.node && @pos == other.pos\n\n      newPos: (node, pos)->\n        if node instanceof Range then new DOMCursor node\n        else new DOMCursor node, pos, @filter\n\n      toString: ->\n        \"DOMCursor(#{@type}, #{@pos}#{if @type == 'text' then ', ' + @posString() else ''})\"\n\n      posString: ->\n        @node.data.substring(0, @pos) + '|' + @node.data.substring @pos\n\n      textPosition: ->\n        if @isEmpty() then null\n        else @savedTextPosition ? (@savedTextPosition = getTextPosition @node, @pos)\n\n      isDomCaretTextPosition: ->\n        p = @textPosition()\n        r = document.caretRangeFromPoint p.left, p.top\n        r.startContainer == @node && r.startOffset == @pos\n\n**Character** returns the character at the position\n\n      character: ->\n        p = if @type == 'text' then this else @save().firstText()\n        p.node.data[p.pos]\n\n**isEmpty** returns true if the cursor is empty\n\n      isEmpty: -> @type == 'empty'\n\n**setFilter** sets the filter\n\n      setFilter: (f)-> new DOMCursor @node, @pos, f\n\n**addFilter** adds a filter\n\n      addFilter: (filt)->\n        oldFilt = @filter\n        @setFilter (n)->\n          (((r1 = oldFilt n) in ['quit', 'skip']) && r1) || (((r2 = filt n) in ['quit', 'skip']) && r2) || (r1 && r2)\n\n**next** moves to the next filtered node\n\n      next: (up)->\n        saved = @save()\n        n = @nodeAfter up\n        while !n.isEmpty()\n          switch res = @filter n\n            when 'skip'\n              n = n.nodeAfter true\n              continue\n            when 'quit' then break\n            else\n              if res then return n\n          n = n.nodeAfter()\n        @restore(saved).emptyNext()\n\n**prev** moves to the next filtered node\n\n      prev: (up)->\n        saved = @save()\n        n = @nodeBefore up\n        while !n.isEmpty()\n          switch res = @filter n\n            when 'skip'\n              n = n.nodeBefore true\n              continue\n            when 'quit' then break\n            else\n              if res then return n\n          n = n.nodeBefore()\n        @restore(saved).emptyPrev()\n\n**nodes** returns all of the nodes this cursor finds\n\n      nodes: ->\n        n = this\n        n.node while !(n = n.next()).isEmpty()\n\n**moveCaret** move the document selection to the current position\n\n      moveCaret: (r)->\n        if !@isEmpty()\n          if !r then r = document.createRange()\n          r.setStart @node, @pos\n          r.collapse true\n          selectRange r\n        this\n\n      adjustForNewline: ->\n        if @isEmpty() then this\n        else\n          s = @save()\n          n = this\n          if @pos == 0 && @node.data[0] == '\\n'\n            while !n.isEmpty() && (n = n.prev()).type != 'text' then\n            if n.isEmpty() then s\n            else\n              if n.node.data[n.pos - 1] == '\\n' then s\n              else n\n          else if @pos == @node.length && @node.data[@pos - 1] == '\\n'\n            while !n.isEmpty() && (n = n.next()).type != 'text' then\n            if n.node.data[n.pos] == '\\n' then s\n            n\n          else this\n\n**range** create a range between two positions\n\n      range: (other, r)->\n        if !r then r = document.createRange()\n        if !other? then other = this\n        r.setStart @node, @pos\n        r.setEnd other.node, other.pos\n        r\n\n**firstText** find the first text node (the 'backwards' argument is optional and if true,\nindicates to find the first text node behind the cursor).\n\n      firstText: (backwards)->\n        n = this\n        while !n.isEmpty() && (n.type != 'text' || (!backwards && n.pos == n.node.data.length))\n          n = (if backwards then n.prev() else n.next())\n        n\n\n**countChars** count the characters in the filtered nodes until we get to (node, pos)\n\nInclude (node, 0) up to but not including (node, pos)\n\n      countChars: (node, pos)->\n        start = @copy()\n        if node instanceof DOMCursor\n          pos = node.pos\n          node = node.node\n        n = this\n        tot = 0\n        while !n.isEmpty() && n.node != node\n          if n.type == 'text' then tot += n.node.length\n          n = n.next()\n        if n.isEmpty() || n.node != node then -1\n        else if n.type == 'text'\n          tot += pos\n          if start.node == n.node then tot -= start.pos\n          tot\n        else tot\n\n**forwardChars** moves the cursor forward by count characters\n\nif contain is true and the final location is 0 then go to the end of\nthe previous text node (node, node.length)\n\n      forwardChars: (count, contain)->\n        if count == 0 then return this\n        n = this\n        count += @pos\n        while !n.isEmpty() && 0 <= count\n          if n.type == 'text'\n            if count < n.node.length\n              if count == 0 && contain\n                n = n.prev()\n                while n.type != 'text' then n = n.prev()\n                return n.newPos n.node, n.node.length\n              else return n.newPos n.node, count\n            count -= n.node.length\n          n = n.next()\n        n.emptyNext()\n\n**hasAttribute** returns true if the node is an element and has the attribute or if it is a text node and its parent has the attribute\n\n      hasAttribute: (a)-> @node? && @node.nodeType == @node.ELEMENT_NODE && @node.hasAttribute a\n\n**getAttribute** returns the attribute if the node is an element and has the attribute\n\n      getAttribute: (a)-> @node? && @node.nodeType == @node.ELEMENT_NODE && @node.getAttribute a\n\n**filterTextNodes** adds text node filtering to the current filter; the cursor will only find text nodes\n\n      filterTextNodes: -> @addFilter (n)-> n.type == 'text'\n\n**filterTextNodes** adds visible text node filtering to the current filter; the cursor will only find visible text nodes\n\n      filterVisibleTextNodes: -> @filterTextNodes().addFilter (n)-> !n.isCollapsed()\n\n**filterParent** adds parent filtering to the current filter; the cursor will only find nodes that are contained in the parent (or equal to it)\n\n      filterParent: (parent)->\n        if !parent then @setFilter -> 'quit'\n        else @addFilter (n)-> parent.contains(n.node) || 'quit'\n\n**filterRange** adds range filtering to the current filter; the cursor will only find nodes that are contained in the range\n\n      filterRange: (startContainer, startOffset, endContainer, endOffset)->\n        if !startOffset?\n          if startContainer instanceof Range\n            r = startContainer\n            startContainer = r.startContainer\n            startOffset = r.startOffset\n            endContainer = r.endContainer\n            endOffset = r.endOffset\n          else return this\n        @addFilter (n)->\n          startPos = startContainer.compareDocumentPosition n.node\n          (if startPos == 0 then startOffset <= n.pos <= endOffset\n          else if startPos & Element.DOCUMENT_POSITION_FOLLOWING\n            endPos = endContainer.compareDocumentPosition n.node\n            if endPos == 0 then n.pos <= endOffset\n            else endPos & Element.DOCUMENT_POSITION_PRECEDING) || 'quit'\n\n**getText** gets all of the text at or after the cursor (useful with filtering; see above)\n\n      getText: ->\n        n = @mutable().firstText()\n        if n.isEmpty() then ''\n        else\n          t = n.node.data.substring n.pos\n          while !(n = n.next()).isEmpty()\n            if n.type == 'text' then t += n.node.data\n          if t.length\n            while n.type != 'text'\n              n.prev()\n            n = n.newPos n.node, n.node.length\n            while n.pos > 0 && reject n.filter n\n              n.pos--\n            t.substring 0, t.length - n.node.length + n.pos\n          else ''\n\n**getTextTo** gets all of the text at or after the cursor (useful with filtering; see above)\n\n      getTextTo: (other)->\n        n = @mutable().firstText()\n        if n.isEmpty() then ''\n        else\n          t = n.node.data.substring n.pos\n          if n.node != other.node\n            while !(n = n.next()).isEmpty()\n              if n.type == 'text' then t += n.node.data\n              if n.node == other.node then break\n          if t.length\n            while n.type != 'text'\n              n.prev()\n            if n.node == other.node then n = n.newPos n.node, other.pos\n            else n = n.newPos n.node, n.node.length\n            while n.pos > 0 && reject n.filter n\n              n.pos--\n            t.substring 0, t.length - n.node.length + n.pos\n          else ''\n\n      char: -> @type == 'text' && @node.data[@pos]\n\n**isNL** returns whether the current character is a newline\n\n      isNL: -> @char() == '\\n'\n\n**endsInNL** returns whether the current node ends with a newline\n\n      endsInNL: -> @type == 'text' && @node.data[@node.length - 1] == '\\n'\n\n**moveToStart** moves to the beginning of the node\n\n      moveToStart: -> @newPos @node, 0\n\n**moveToNextStart** moves to the beginning of the next node\n\n      moveToNextStart: -> @next().moveToStart()\n\n**moveToEnd** moves to the textual end the node (1 before the end if the node\nends in a newline)\n\n      moveToEnd: ->\n        end = @node.length - (if @endsInNL() then 1 else 0)\n        @newPos @node, end\n\n**moveToPrevEnd** moves to the textual end the previous node (1 before\nthe end if the node ends in a newline)\n\n      moveToPrevEnd: -> @prev().moveToEnd()\n\n**forwardWhile** moves forward until the given function is false or 'found',\nreturning the previous position if the function is false or the current\nposition if the function is 'found'\n\n      forwardWhile: (test)->\n        prev = n = @immutable()\n        while n = n.forwardChar()\n          if n.isEmpty() || !(t = test n) then return prev\n          if t == 'found' then return n\n          prev = n\n\n**checkToEndOfLine** checks whether a condition is true until the EOL\n\n      checkToEndOfLine: (test)->\n        n = @immutable()\n        tp = n.textPosition()\n        while !n.isEmpty() && (test n)\n          if differentLines tp, n.textPosition() then return true\n          n = n.forwardChar()\n        n.isEmpty()\n\n**checkToStartOfLine** checks whether a condition is true until the EOL\n\n      checkToStartOfLine: (test)->\n        n = @immutable()\n        tp = n.textPosition()\n        while !n.isEmpty() && (test n)\n          if differentLines tp, n.textPosition() then return true\n          n = n.backwardChar()\n        n.isEmpty()\n\n**endOfLine** moves to the end of the current line\n\n      endOfLine: ->\n        tp = @textPosition()\n        @forwardWhile (n)-> !differentLines tp, n.textPosition()\n\n**forwardLine** moves to the next line, trying to keep the current screen pixel column.  Optionally takes a goalFunc that takes the position's screen pixel column as input and returns -1, 0, or 1 from comparing the input to the an goal column\n\n      forwardLine: (goalFunc)->\n        if !goalFunc then goalFunc = -> -1\n        line = 0\n        tp = @textPosition()\n        @forwardWhile (n)->\n          pos = n.textPosition()\n          if differentLines tp, pos\n            tp = pos\n            line++\n          if line == 1 && goalFunc(pos.left + 2) > -1 then 'found'\n          else line != 2\n\n**backwardWhile** moves backward until the given function is false or 'found',\nreturning the previous position if the function is false or the current\nposition if the function is 'found'\n\n      backwardWhile: (test)->\n        prev = n = @immutable()\n        while n = n.backwardChar()\n          if n.isEmpty() || !(t = test n) then return prev\n          if t == 'found' then return n\n          prev = n\n\n**endOfLine** moves to the end of the current line\n\n      startOfLine: ->\n        tp = @textPosition()\n        @backwardWhile (n)-> !differentLines tp, n.textPosition()\n\n      differentPosition: (c)-> differentPosition @textPosition(), c.textPosition()\n\n      differentLines: (c)-> differentLines @textPosition(), c.textPosition()\n\n**backwardLine** moves to the previous line, trying to keep the current screen pixel column.  Optionally takes a goalFunc that takes the position's screen pixel column as input and returns -1, 0, or 1 from comparing the input to an internal goal column\n\n      backwardLine: (goalFunc)->\n        # optional goalFunc takes the position's screen pixel column as input\n        # It returns -1, 0, or 1, comparing the input to the internal goal column\n        if !goalFunc then goalFunc = -> -1\n        tp = @textPosition()\n        line = 0\n        (@backwardWhile (n)->\n          pos = n.textPosition()\n          if differentLines tp, pos\n            tp = pos\n            line++\n          if line == 1 && goalFunc(n.textPosition().left - 2) in [-1, 0] then 'found'\n          else line != 2).adjustBackward()\n\n      adjustBackward: ->\n        p = @textPosition()\n        @backwardWhile (n)-> !differentPosition p, n.textPosition()\n\n      forwardChar: ->\n        if @pos + 1 <= @node.length then @newPos @node, @pos + 1\n        else\n          n = this\n          while !(n = n.next()).isEmpty()\n            if n.node.length != 0 then break\n          n\n\n      boundedForwardChar: ->\n        n = @save().forwardChar()\n        if n.isEmpty() then n.prev() else n\n\n      backwardChar: ->\n        p = this\n        oldNode = @node\n        while !p.isEmpty() && p.pos == 0\n          p = p.prev()\n        if !p.isEmpty() then p.newPos p.node, (if p.node != oldNode then p.pos else p.pos - 1)\n        else p\n\n      boundedBackwardChar: ->\n        n = @save().backwardChar()\n        if n.isEmpty() then n.next() else n\n\n**show** scroll the position into view.  Optionally takes a rectangle representing a toolbar at the top of the page (sorry, this is a bit limited at the moment)\n\n      show: (topRect)->\n        if p = @textPosition()\n          top = if topRect?.width && topRect.top == 0 then topRect.bottom else 0\n          if p.bottom > window.innerHeight then window.scrollBy 0, p.bottom - window.innerHeight\n          else if p.top < top then window.scrollBy 0, p.top - top\n        this\n\n**immutable** return an immutable version of this cursor\n\n      immutable: -> this\n\n**withMutations** call a function with a mutable version of this cursor\n\n      withMutations: (func)-> func @copy().mutable()\n\n**mutable** return a mutable version of this cursor\n\n      mutable: -> new MutableDOMCursor @node, @pos, @filter\n\n**save** generate a memento which can be used to restore the state (used by mutable cursors)\n\n      save: -> this\n\n**restore** restore the state from a memento (used by mutable cursors)\n\n      restore: (n)-> n.immutable()\n\n**copy** return a copy of this cursor\n\n      copy: -> this\n\n**nodeAfter** low level method that moves to the unfiltered node after the current one\n\n      nodeAfter: (up)->\n        node = @node\n        while node\n          if node.nodeType == node.ELEMENT_NODE && !up && node.childNodes.length\n            return @newPos node.childNodes[0], 0\n          else if node.nextSibling\n            return @newPos node.nextSibling, 0\n          else\n            up = true\n            node = node.parentNode\n        @emptyNext()\n\n**emptyNext** returns an empty cursor whose prev is the current node\n\n      emptyNext: ->\n        # return an empty next node where\n        #   prev returns this node\n        #   next returns the same empty node\n        __proto__: emptyDOMCursor\n        filter: @filter\n        prev: (up)=> if up then @prev up else this\n        nodeBefore: (up)=> if up then @nodeBefore up else this\n\n**nodeBefore** low level method that moves to the unfiltered node before the current one\n\n      nodeBefore: (up)->\n        node = @node\n        while node\n          if node.nodeType == node.ELEMENT_NODE && !up && node.childNodes.length\n            newNode = node.childNodes[node.childNodes.length - 1]\n          else if node.previousSibling then newNode = node.previousSibling\n          else\n            up = true\n            node = node.parentNode\n            continue\n          return @newPos newNode, newNode.length\n        @emptyPrev()\n\n**emptyPrev** returns an empty cursor whose next is the current node\n\n      emptyPrev: ->\n        # return an empty prev node where\n        #   next returns this node\n        #   prev returns the same empty node\n        __proto__: emptyDOMCursor\n        filter: @filter\n        next: (up)=> if up then @next up else this\n        nodeAfter: (up)=> if up then @nodeAfter up else this\n\nEmptyDOMCursor Class\n--------------------\n\nAn empty cursor\n\n    class EmptyDOMCursor extends DOMCursor\n      moveCaret: -> this\n      show: -> this\n      nodeAfter: -> this\n      nodeBefore: -> this\n      next: -> this\n      prev: -> this\n\n    #singleton empty node cursor\n    emptyDOMCursor = new EmptyDOMCursor()\n\nMutableDOMCursor Class\n----------------------\n\nA mutable cursor -- cursor movement, filter changes, etc. change the cursor instead of returning a new one.\n\n    class MutableDOMCursor extends DOMCursor\n      setFilter: (@filter)-> this\n      newPos: (@node, @pos)->\n        @savedTextPosition = null\n        @computeType()\n      copy: -> new MutableDOMCursor @node, @pos, @filter\n      mutable: -> this\n      immutable: -> new DOMCursor @node, @pos, @filter\n      save: -> @immutable()\n      restore: (np)->\n        @node = np.node\n        @pos = np.pos\n        @filter = np.filter\n        this\n      emptyPrev: ->\n        @type = 'empty'\n        @next = (up)->\n          @revertEmpty()\n          if up then @next up else this\n        @nodeAfter = (up)->\n          @computeType()\n          if up then @nodeAfter up else this\n        @prev = -> this\n        @nodeBefore = -> this\n        this\n      revertEmpty: ->\n        @computeType()\n        delete @next\n        delete @prev\n        delete @nodeAfter\n        delete @nodeBefore\n        this\n      emptyNext: ->\n        @type = 'empty'\n        @prev = (up)->\n          @revertEmpty()\n          if up then @prev up else this\n        @nodeBefore = (up)->\n          @computeType()\n          if up then @nodeBefore up else this\n        @next = -> this\n        @nodeAfter = -> this\n        this\n\nUtility functions\n-----------------\n\nThese are available as properties on DOMCursor.\n\nThanks to (rangy)[this: https://github.com/timdown/rangy] for the isCollapsed logic\n\n    isCollapsed = (node)->\n      if node\n        type = node.nodeType\n        type == 7 || # PROCESSING_INSTRUCTION\n        type == 8 || # COMMENT\n        (type == node.TEXT_NODE && (node.data == '' || isCollapsed(node.parentNode))) ||\n        /^(script|style)$/i.test(node.nodeName) ||\n        (type == node.ELEMENT_NODE && !node.offsetParent)\n\n    selectRange = (r)->\n      if r\n        debug \"select range\", r, new Error('trace').stack\n        sel = getSelection()\n        if !(sel.rangeCount == 1 && sameRanges sel.getRangeAt(0), r)\n          sel.setBaseAndExtent r.startContainer, r.startOffset, r.endContainer, r.endOffset\n\n    sameRanges = (r1, r2)->\n      r1.compareBoundaryPoints(Range.START_TO_START, r2) == 0 &&\n        r1.compareBoundaryPoints(Range.END_TO_END, r2) == 0\n\n    debug = (args...)-> if DOMCursor.debug then console.log args...\n\n    reject = (filterResult)-> !filterResult || (filterResult in ['quit', 'skip'])\n\nNode location routines\n----------------------\n\n    positioner = document.createElement 'DIV'\n\n    positioner.setAttribute 'style', 'display: inline-block'\n\n    positioner.innerHTML = 'x'\n\n    spareRange = document.createRange()\n\n    emptyRect = width: 0, height: 0\n\n    getTextPosition = (textNode, offset)->\n      if offset < textNode.length\n        spareRange.setStart textNode, offset\n        spareRange.setEnd textNode, offset + 1\n        r = getClientRect spareRange\n        if !r || (r.width == 0 && r.height == 0)\n          spareRange.selectNodeContents textNode.parentNode\n          if spareRange.getClientRects().length == 0\n            r = textNode.parentNode.getBoundingClientRect()\n      else\n        spareRange.setStart textNode, offset\n        spareRange.collapse true\n        r = getClientRect spareRange\n      if !r || (r.width == 0 && r.height == 0)\n        if offset == 0 then textNode.parentNode.insertBefore positioner, textNode\n        else if offset == textNode.length || textNode.splitText offset\n          textNode.parentNode.insertBefore positioner, textNode.nextSibling\n        spareRange.selectNode positioner\n        r = spareRange.getBoundingClientRect()\n        positioner.parentNode.removeChild positioner\n        textNode.parentNode.normalize()\n      r\n\n    chooseUpper = (r1, r2)-> r1.top < r2.top\n\n    chooseLower = (r1, r2)-> r1.top > r2.top\n\n    getClientRect = (r)->\n      rects = r.getClientRects()\n      if rects.length == 1 then rects[0]\n      else if rects.length == 2\n        result = rects[0]\n        #comp = if r.startContainer.data[r.startOffset] == '\\n' then chooseUpper\n        comp = if r.startContainer.data[r.startOffset] == '\\n' && r.startOffset > 0 && r.startContainer.data[r.startOffset] != '\\n'\n          chooseUpper\n        else chooseLower\n        for rect in rects\n          if comp rect, result then result = rect\n        result\n      else emptyRect\n\n    differentPosition = (pos1, pos2)->\n      differentLines(pos2, pos1) ||\n        if pos1.right? && pos2.right?\n          r1 = Math.floor(pos1.right)\n          r2 = Math.floor(pos2.right)\n          l1 = Math.floor(pos1.left)\n          l2 = Math.floor(pos2.left)\n          (r1 != r2 || l1 != l2) && (r2 < l1 || r1 < l2 || ((r1 < r2) == (l1 < l2) && (r1 > r2) == (l1 > l2)))\n        else Math.floor(pos1.left) != Math.floor(pos2.left)\n\n    differentLines = (pos1, pos2)->\n      (pos1.bottom - 4 <= pos2.top) || (pos2.bottom - 4 <= pos1.top)\n\n    DOMCursor.MutableDOMCursor = MutableDOMCursor\n    DOMCursor.emptyDOMCursor = emptyDOMCursor\n    DOMCursor.isCollapsed = isCollapsed\n    DOMCursor.selectRange = selectRange\n    DOMCursor.getTextPosition = getTextPosition\n    DOMCursor.differentPosition = differentPosition\n    DOMCursor.differentLines = differentLines\n    DOMCursor.debug = false\n"
  ]
}