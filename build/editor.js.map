{
  "version": 3,
  "file": "editor.js",
  "sourceRoot": "..",
  "sources": [
    "editor.litcoffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "LeisureEditCore ([example editor](http://team-cthulhu.github.io/LeisureEditCore/examples/index.html))\n===============\nCopyright (C) 2015, Bill Burdick, Roy Riggs, TEAM CTHULHU\n\nLicensed with ZLIB license (see \"[License](#license)\", below).\n\nWelcome to LeisureEditCore!  Are you trying to make editable documents\nthat are more than just text editors or word processors?  This library\ntries to make it easier to make interesting editable documents.  You\ncan find it on [Github](https://github.com/TEAM-CTHULHU/LeisureEditCore).\nLeisureEditCore what [Leisure's](https://github.com/zot/Leisure)\neditor, extracted out into a small HTML5 library.  LeisureEditCore is\npluggable with an options object that contains customization hooks.\nCode and examples are in Coffeescript (a JS build is provided as a\nconvenience).\n\nBasic Idea\n==========\n\nLeisureEditCore edits a doubly-linked list of newline-terminated text\n\"blocks\" that can render as DOM nodes (and maybe in interesting ways!)\n\nThe rendered DOM tree contains the full text of the block list in the\nproper order, along with ids from the blocks.  Some of the text may\nnot be visible and there may be a lot of items in the rendered DOM\nthat are not in the blocks.  Also, the rendered DOM may have a nested\ntree-structure.\n\nWhen the user makes a change, the editor:\n\n  1. maps the cursor location in the DOM to the corresponding location in the blocks\n  2. changes block text, regenerating part of the blocks\n  3. rerenders the DOM corresponding to the changed blocks\n  4. replaces the new DOM into the page\n\n![Editor flow](editorFlow.png)\n\nOf course the editor supports [custom key bindings](#defaultBindings).\n\nUsing/Installing LeisureEditCore\n================================\nMake sure your webpage loads the javascript files in the `build` directory.  Follow\nthe instructions below to use it.\n\n[Here](http://team-cthulhu.github.io/LeisureEditCore/examples/index.html) is an example that edits org-mode text.\n\nBlocks\n------\n  * `_id`: the block id\n  * `text`: the text of the block\n  * `prev`: the id of the previous block (optional)\n  * `next`: the id of the next block (optional)\n  * EXTRA STUFF: you can store whatever extra things you like in your text blocks\n\nBlockOffsets\n------------\n{block: aBlock, offset: aNumber}\naBlock can be an id or a block\n\nEditor (see below for more detailed documentation)\n--------------------------------------------------\nAn instance of LeisureEditCore.  You must provide an HTML node to\ncontain the document contents and an options object to configure the\neditor.\n\nEditor options object (see below for more detailed documentation)\n-----------------------------------------------------------------\nDataStoreEditingOptions is the recommended options object but\nyou can also subclass BasicEditingOptions.\n\nData object (see below for more detailed documentation)\n-------------------------------------------------------\nManages the document.  It's responsible for parsing text into blocks,\naccessing the blocks, making changes, and converting between block\nlocations and document locations.\n\nBasic usage\n-----------\nTo use this in the recommended way...\n\n1. The code uses AMD style and depends on 'lodash', 'fingertree', and 'immutable' which you will probably need to map.  This is so that if you are using any of these packages, you won't have to include them more than once.\n1. Subclass DataStoreEditingOptions and provide a renderBlock(block) method\n1. Subclass DataStore and provide a parseBlocks(text) method\n1. Create an editor object with your options object on your data object\n1. Call the load(name, text) method on your options object\n\nIncluded packages\n=================\n- [DOMCursor](https://github.com/zot/DOMCursor) -- locating text in DOM trees\n\nThird-party packages we use (also included)\n===========================================\n- [lodash](https://lodash.com/) -- collection, FP, and async utilities\n- [fingertree](https://github.com/qiao/fingertree.js) -- the swiss army knife of data structures\n- [immutable](http://facebook.github.io/immutable-js) -- immutable data structures\n\nBuilding\n========\nIf you modify LeisureEditCore and want to build it, you can use the Cakefile.  It needs the\n`which` npm package (`npm install which`).\n\n<a name=\"license\"></a>License\n=============================\nLicensed with ZLIB license.\n\nThis software is provided 'as-is', without any express or implied\nwarranty. In no event will the authors be held liable for any damages\narising from the use of this software.\n\nPermission is granted to anyone to use this software for any purpose,\nincluding commercial applications, and to alter it and redistribute it\nfreely, subject to the following restrictions:\n\n1. The origin of this software must not be misrepresented; you must not\nclaim that you wrote the original software. If you use this software\nin a product, an acknowledgment in the product documentation would be\nappreciated but is not required.\n\n2. Altered source versions must be plainly marked as such, and must not be\nmisrepresented as being the original software.\n\n3. This notice may not be removed or altered from any source distribution.\n\nLeisureEditCore\n===============\nCreate a LeisureEditCore object like this: `new LeisureEditCore editorElement, options`.\n\n`editorElement` is the HTML element that you want to contain editable text.\n\n`options` is an object that tells LeisureEditCore things like how to\nconvert text to a list of block objects (see below).  See\nBasicEditingOptions and DataStoreEditingOptions for more info.\n\n    import {Set} from './immutable-4.0.0-rc.15.js'\n    import {DOMCursor} from './domCursor.js'\n    import {FingerTree} from './fingertree.js'\n    import {Observable, BasicEditingOptionsNew, spaces, sameCharacter, computeNewStructure,\n            copyBlock, DataStore, FeatherJQ, $, is$} from './editor-ts.js'\n    export {copyBlock, DataStore, FeatherJQ, $, is$, set$} from './editor-ts.js'\n\n    {selectRange} = DOMCursor\n    imbeddedBoundary = /.\\b./\n    maxLastKeys = 4\n    BS = 8\n    ENTER = 13\n    DEL = 46\n    TAB = 9\n    LEFT = 37\n    UP = 38\n    RIGHT = 39\n    DOWN = 40\n    HOME = 36\n    END = 35\n    PAGEUP = 33\n    PAGEDOWN = 34\n    specialKeys = {}\n    specialKeys[TAB] = 'TAB'\n    specialKeys[ENTER] = 'ENTER'\n    specialKeys[BS] = 'BS'\n    specialKeys[DEL] = 'DEL'\n    specialKeys[LEFT] = 'LEFT'\n    specialKeys[RIGHT] = 'RIGHT'\n    specialKeys[UP] = 'UP'\n    specialKeys[DOWN] = 'DOWN'\n    specialKeys[PAGEUP] = 'PAGEUP'\n    specialKeys[PAGEDOWN] = 'PAGEDOWN'\n    specialKeys[HOME] = 'HOME'\n    specialKeys[END] = 'END'\n\nKey funcs\n---------\n\nBasic functions used by [defaultBindings](#defaultBindings)\n\n    export useEvent = (e)->\n      e.preventDefault()\n      e.stopPropagation()\n\n    keyFuncs =\n      backwardChar: (editor, e, r)->\n        useEvent e\n        editor.moveSelectionBackward r\n        false\n      forwardChar: (editor, e, r)->\n        useEvent e\n        editor.moveSelectionForward r\n        false\n      previousLine: (editor, e, r)->\n        useEvent e\n        editor.moveSelectionUp r\n        false\n      nextLine: (editor, e, r)->\n        useEvent e\n        editor.moveSelectionDown r\n        false\n      stabilizeCursor: (editor, e, r)->\n        setTimeout (-> editor.domCursorForCaret().moveCaret()), 1\n        false\n\n<a name=\"defaultBindings\"></a>Default key bindings\n--------------------------------------------------\n\nThese are the default bindings.  You can set the editor's bindings\nproperty to this or your own object (which can inherit from this, of\ncourse.)\n\n    export defaultBindings =\n      #'C-S': keyFuncs.save\n      'C-Z': -> alert 'UNDO not supported yet'\n      'C-S-Z': -> alert 'REDO not supported yet'\n      'C-Y': -> alert 'REDO not supported yet'\n      'UP': keyFuncs.previousLine\n      'DOWN': keyFuncs.nextLine\n      'LEFT': keyFuncs.backwardChar\n      'RIGHT': keyFuncs.forwardChar\n      'HOME': keyFuncs.stabilizeCursor\n      'END': keyFuncs.stabilizeCursor\n      'C-HOME': keyFuncs.stabilizeCursor\n      'C-END': keyFuncs.stabilizeCursor\n      #'TAB': keyFuncs.expandTemplate\n      #'C-C C-C': keyFuncs.swapMarkup\n      #'M-C': keyFuncs.execute\n      #'C-F': keyFuncs.forwardChar\n      #'C-B': keyFuncs.backwardChar\n      #'C-P': keyFuncs.previousLine\n      #'C-N': keyFuncs.nextLine\n      #'C-X C-F': keyFuncs.save\n    dragRange = null\n\n`idCounter`: id number for next created block\n\n    idCounter = 0\n\n#    export class Observable\n#      constructor: ->\n#        @listeners = {}\n#        @suppressingTriggers = false\n#      on: (type, callback)->\n#        if typeof type == 'object'\n#          for type, callback of type\n#            @on type callback\n#        else\n#          if !@listeners[type] then @listeners[type] = []\n#          @listeners[type].push callback\n#        this\n#      off: (type, callback)->\n#        if typeof type == 'object'\n#          for callbackType, callback of type\n#            @off callbackType, callback\n#        else\n#          if @listeners[type]\n#            @listeners[type] = @listeners[type].filter (l)-> l != callback\n#        this\n#      trigger: (type, args...)->\n#        if !@suppressingTriggers\n#          for listener in @listeners[type] || []\n#            listener args...\n#      suppressTriggers: (func)->\n#        oldSuppress = @suppressingTriggers\n#        @suppressingTriggers = true\n#        try\n#          func()\n#        finally\n#          @suppressingTriggers = oldSuppress\n#\n#    readyPromise = new Promise (accept, reject)->\n#      if document.readyState == 'interactive' then accept null\n#      else\n#        document.onreadystatechange = ()->\n#          if document.readyState == 'interactive' then accept null\n#    \n#    ready = (func)-> readyPromise.then func\n#\n#FeatherJQ class\n#===============\n#A featherweight JQuery replacement.  Users can use set$ to make it use\n#the real jQuery, like this: `set$($, (obj)-> obj instanceof $)`\n#\n#    export class FeatherJQ extends Array\n#      constructor: (specs...)->\n#        results = []\n#        results.__proto__ = FeatherJQ.prototype\n#        for spec in specs\n#          results.pushResult spec\n#        return results\n#      find: (sel)->\n#        results = $()\n#        for node in this\n#          if node.querySelectorAll?\n#            for result in node.querySelectorAll(sel)\n#              results.push result\n#        results\n#      attr: (name, value)->\n#        if value?\n#          for node in this\n#            node.setAttribute name, value\n#          this\n#        else this[0]?getAttribute name\n#      prop: (name, value)->\n#        if value?\n#          for node in this\n#            node[name] = value\n#          this\n#        else this[0]?[name]\n#      closest: (sel)->\n#        result = $()\n#        for node in this\n#          if n = (if node.closest? then node else node.parentNode).closest sel\n#            result.push n\n#        result\n#      is: (sel)->\n#        for node in this\n#          if node.matches? sel then return true\n#        false\n#      parent: ->\n#        result = $()\n#        for node in this\n#          if p = node.parentNode then result.push p\n#        result\n#      data: (key, value)->\n#        if !key then getUserData this[0], true\n#        else if !value? then getUserData(this[0], true)?[key]\n#        else for node in this\n#          getUserData(node, true)[key] = value\n#          this\n#      on: (evtType, func)->\n#        for node in this\n#          evt = getEvents node\n#          if !evt[evtType]\n#            node.addEventListener evtType, runEvent\n#            evt[evtType] = []\n#          evt[evtType].push func\n#      off: (evtType, func)->\n#        for node in this when events = getEvents(node) && events[evtType]\n#          events = if func then (h for h in events[evtType] when h != func) else []\n#          if !events.length then delete events[evtType]\n#      pushResult: (spec)->\n#        if typeof spec == 'string'\n#          try\n#            @push document.querySelectorAll(spec)...\n#          catch err\n#            div = document.createElement 'div'\n#            div.innerHTML = html\n#            @push div.children...\n#        #else if spec instanceof FeatherJQ then @push spec...\n#        else if typeof spec == 'object' && spec.nodeName then @push spec\n#        else if typeof spec == 'object' && spec.prop then @push spec...\n#        else @push spec\n#      ready: (func)-> ready func\n#      html: (newHtml)->\n#        for node in this\n#          node.innerHTML = newHtml\n#\n#    $func = (args...)-> new FeatherJQ(args...)\n#\n#    export $ = $func\n#\n#    export is$ = (obj)-> obj instanceof FeatherJQ || (obj.prop && obj.attr)\n#\n#    export set$ = (new$, is$Func)->\n#      $ = $func = new$\n#      is$ = is$Func || is$\n#\n#    FJQData = new WeakMap\n#\n#    runEvent = (evt)->\n#      for handler in getEvents(evt.currentTarget) ? []\n#        handler evt\n#      null\n#\n#    getNodeData = (node, create)->\n#      if create || FJQData.has node\n#        if !FJQData.has node then FJQData.set node, {}\n#        FJQData.get node\n#\n#    getDataProperty = (node, prop, create)->\n#      if d = getNodeData node, create\n#        if !d[prop] then d[prop] = {}\n#        d[prop]\n#\n#    getUserData = (node, create)-> if node then getDataProperty node, 'userData', create\n#\n#    getEvents = (node, create)-> getDataProperty node, 'events', create\n#\n#    $.ready = FeatherJQ.ready = ready\n#\n#    $.ajax = FeatherJQ.ajax = ({url, success, data})->\n#      xhr = new XMLHttpRequest\n#      xhr.onreadystatechange = ->\n#          if xhr.readyState == XMLHttpRequest.DONE then success xhr.responseText\n#      xhr.open (if data then 'POST' else 'GET'), url, true\n#      xhr.send data\n#\n#    $.get = FeatherJQ.get = (url, success)-> FeatherJQ.ajax {url, success}\n\n    detail = (e)-> originalEvent(e).detail\n    originalEvent = (e)-> (e.originalEvent) || e\n\nLeisureEditCore class\n=====================\nEvents:\n  `moved`: the cursor moved\n\n    export class LeisureEditCore extends Observable\n      constructor: (@node, @options)->\n        super()\n        @editing = false\n        @node\n          .attr 'contenteditable', 'true'\n          .attr 'spellcheck', 'false'\n          .data 'editor', this\n        @curKeyBinding = @prevKeybinding = null\n        @bind()\n        @lastKeys = []\n        @modCancelled = false\n        @clipboardKey = null\n        @ignoreModCheck = 0\n        @movementGoal = null\n        @options.setEditor this\n        @currentSelectedBlock = null\n      editWith: (func)->\n        @editing = true\n        try\n          func()\n        finally\n          @editing = false\n      savePosition: (func)->\n        if @editing then func()\n        else\n          pos = @getSelectedDocRange()\n          try\n            func()\n          catch\n            @selectDocRange pos\n      getCopy: (id)-> copyBlock @options.getBlock id\n      getText: -> @options.getText()\n      blockForCaret: -> @blockForNode @domCursorForCaret().node\n      blockForNode: (node)-> @options.getBlock @options.idForNode node\n      blockNodeForNode: (node)-> @options.nodeForId @options.idForNode node\n      blockTextForNode: (node)->\n        parent = @blockNodeForNode(node)[0]\n        if next = @options.getBlock(@options.idForNode node)?.next\n          nextPos = @domCursorForText @options.nodeForId(next), 0\n          @domCursorForText(parent, 0, parent).getTextTo nextPos\n        else @domCursorForText(parent, 0, parent).getText()\n      verifyNode: (node)->\n        if typeof node == 'string' then node = @options.nodeForId node\n        @blockTextForNode(node) == @options.getBlock(@options.idForNode node).text\n      verifyAllNodes: ->\n        badIds = []\n        block = @options.getBlock @options.getFirst()\n        while block\n          if (node = @options.nodeForId(block._id)[0]) && !@verifyNode node\n            badIds.push block._id\n          block = @options.getBlock block.next\n        if badIds.length then badIds\n      domCursor: (node, pos)->\n        if is$ node\n          node = node[0]\n          pos = pos ? 0\n        else if node instanceof DOMCursor\n          pos = node.pos\n          node = node.node\n        @options.domCursor(node, pos)\n      makeElementVisible: (node)->\n        r = DOMCursor.getBoundingRect(node)\n        view = @node[0].getBoundingClientRect()\n        if r.top < view.top\n          @node[0].scrollTop -= view.top - r.top\n        else if r.bottom > view.bottom\n          @node[0].scrollTop += r.bottom - view.bottom\n      domCursorForText: (node, pos, parent)->\n        c = @domCursor $(node)[0], pos\n          .filterTextNodes()\n          .firstText()\n        if parent? then c.filterParent $(parent)[0] else c\n      domCursorForTextPosition: (parent, pos, contain)->\n        @domCursorForText parent, 0, (if contain then parent)\n          .mutable()\n          .forwardChars pos, contain\n          .adjustForNewline()\n      domCursorForCaret: ->\n        sel = getSelection()\n        if sel.type == 'None' then DOMCursor.emptyDOMCursor\n        else\n          r = sel.getRangeAt 0\n          n = @domCursor r.startContainer, r.startOffset\n            .mutable()\n            .filterVisibleTextNodes()\n            .filterParent @node[0]\n            .firstText()\n          if n.isEmpty() || n.pos <= n.node.length then n else n.next()\n      getTextPosition: (parent, target, pos)->\n        if parent\n          targ = @domCursorForText target, pos\n          if !@options.getContainer(targ.node) then targ = targ.prev()\n          @domCursorForText parent, 0, parent\n            .mutable()\n            .countChars targ.node, targ.pos\n        else -1\n      loadURL: (url)-> $.get url, (text)=> @options.load url, text\n      domCursorForDocOffset: (dOff)->\n        bOff = @options.blockOffsetForDocOffset dOff\n        node = @options.nodeForId bOff.block\n        @domCursorForText(node, 0, @node[0]).mutable().forwardChars bOff.offset\n      docOffsetForCaret: ->\n        s = getSelection()\n        if s.type == 'None' then -1\n        else\n          range = s.getRangeAt 0\n          @docOffset range.startContainer, range.startOffset\n      docOffsetForBlockOffset: (block, offset)->\n        @options.docOffsetForBlockOffset block, offset\n      docOffset: (node, offset)->\n        if node instanceof Range\n          offset = node.startOffset\n          node = node.startContainer\n        else if node instanceof DOMCursor\n          offset = node.pos\n          node = node.node\n        if startHolder = @options.getContainer(node)\n          @options.docOffsetForBlockOffset @options.idForNode(startHolder), @getTextPosition startHolder, node, offset\n      getSelectedDocRange: ->\n        s = getSelection()\n        if s.type == 'None' then type: 'None'\n        else\n          range = s.getRangeAt 0\n          if start = @docOffset range.startContainer, range.startOffset\n            if s.type == 'Caret' then length = 0\n            else\n              end = @docOffset range.endContainer, range.endOffset\n              length = Math.abs start - end\n              start = Math.min start, end\n            type: s.type\n            start: start\n            length: length\n            scrollTop: @node[0].scrollTop\n            scrollLeft: @node[0].scrollLeft\n          else type: 'None'\n      selectDocRange: (range)->\n        if range.type != 'None' && !(start = @domCursorForDocOffset(range.start).save()).isEmpty()\n          selectRange start.range(start.mutable().forwardChars range.length)\n          @node[0].scrollTop = range.scrollTop\n          @node[0].scrollLeft = range.scrollLeft\n      getSelectedBlockRange: ->\n        s = getSelection()\n        if s.type != 'None' && p = @blockOffset s.getRangeAt(0)\n          p.type = s.type\n          p.length = @selectedText(s).length\n          p\n        else type: 'None'\n      blockOffset: (node, offset)->\n        if node instanceof Range\n          offset = node.startOffset\n          node = node.startContainer\n        else if node instanceof DOMCursor\n          offset = node.pos\n          node = node.node\n        if startHolder = @options.getContainer(node)\n          block: @options.getBlock @options.idForNode startHolder\n          offset: @getTextPosition startHolder, node, offset\n      blockRangeForOffsets: (start, length)->\n        {block, offset} = @options.getBlockOffsetForPosition start\n        {block, offset, length, type: if length == 0 then 'Caret' else 'Range'}\n      replace: (e, br, text, select)-> if br.type != 'None'\n        @editWith =>\n          start = @options.docOffsetForBlockOffset(br)\n          pos = @getSelectedDocRange()\n          text = text ? getEventChar e\n          @options.replaceText {start, end: start + br.length, text, source: 'edit'}\n          if select\n            pos.type = if text.length == 0 then 'Caret' else 'Range'\n            pos.length = text.length\n          else\n            pos.type = 'Caret'\n            pos.length = 0\n            pos.start += text.length\n          @selectDocRange pos\n      backspace: (event, sel, r)->\n        if sel.type == 'Range' then return @cutText event\n        holderId = @idAtCaret sel\n        @currentBlockIds = [holderId]\n        @handleDelete event, sel, false\n      del: (event, sel, r)->\n        if sel.type == 'Range' then return @cutText event\n        holderId = @idAtCaret sel\n        @currentBlockIds = [holderId]\n        @handleDelete event, sel, true\n      idAtCaret: (sel)-> @options.idForNode @options.getContainer(sel.anchorNode)\n      selectedText: (s)->\n        r = s.getRangeAt(0)\n        if r.collapsed then ''\n        else @domCursor(r.startContainer, r.startOffset).getTextTo @domCursor(r.endContainer, r.endOffset)\n      cutText: (e)->\n        useEvent e\n        sel = getSelection()\n        if sel.type == 'Range'\n          html = _.map(sel.getRangeAt(0).cloneContents().childNodes, htmlForNode).join ''\n          text = @selectedText sel\n          @options.simulateCut html: html, text: text\n          r = @getSelectedDocRange()\n          @replace e, @getSelectedBlockRange(), ''\n          @selectDocRange\n            type: 'Caret'\n            start: r.start\n            length: 0\n            scrollTop: r.scrollTop\n            scrollLeft: r.scrollLeft\n      handleDelete: (e, s, forward)->\n        useEvent e\n        r = @getSelectedDocRange()\n        if r.type == 'None' || (r.type == 'Caret' && ((forward && r.start >= @options.getLength() - 1) || (!forward && r.start == 0)))\n          return\n        if r.type == 'Caret'\n          r.length = 1\n          if !forward then r.start -= 1\n        @options.replaceText\n          start: r.start\n          end: r.start + r.length\n          text: ''\n          source: 'edit'\n        @selectDocRange\n          type: 'Caret'\n          start: r.start\n          length: 0\n          scrollTop: r.scrollTop\n          scrollLeft: r.scrollLeft\n      bind: ->\n        @bindDragAndDrop()\n        @bindClipboard()\n        @bindMouse()\n        @bindKeyboard()\n      bindDragAndDrop: ->\n        @node.on 'dragover', (e)=>\n          @options.dragOver originalEvent e\n          true\n        @node.on 'dragenter', (e)=>\n          @options.dragEnter originalEvent e\n          true\n        @node.on 'drop', (e)=>\n          useEvent e\n          oe = originalEvent e\n          oe.dataTransfer.dropEffect = 'move'\n          r = DOMCursor.caretPos oe.clientX, oe.clientY\n          dropPos = @domCursor(r.node, r.offset).moveCaret()\n          dropContainer = @domCursor @options.getContainer(r.node), 0\n          blockId = @options.idForNode dropContainer.node\n          offset = dropContainer.countChars dropPos\n          insertText = oe.dataTransfer.getData('text/plain')\n          insert = => @replace e, {type: 'Caret', offset, block: @options.getBlock(blockId), length: 0}, insertText, false\n          if dragRange\n            start = @domCursor(@options.nodeForId(dragRange.block._id), 0).forwardChars dragRange.offset\n            r2 = start.range start.forwardChars dragRange.length\n            insertOffset = @options.getPositionForBlock(@options.getBlock blockId) + offset\n            cutOffset = @options.getPositionForBlock(dragRange.block) + dragRange.offset\n            if cutOffset <= insertOffset <= cutOffset + dragRange.length\n              useEvent oe\n              oe.dataTransfer.dropEffect = 'none'\n              return\n            dr = dragRange\n            dragRange = null\n            if insertOffset <= cutOffset\n              @replace e, dr, '', false\n              @replace e, @blockRangeForOffsets(insertOffset, 0), insertText, false\n            else\n              insert()\n              @replace e, @blockRangeForOffsets(cutOffset, dr.length), '', false\n          else insert()\n          true\n        @node.on 'dragstart', (e)=>\n          sel = getSelection()\n          if sel.type == 'Range'\n            dragRange = @getSelectedBlockRange()\n            clipboard = originalEvent(e).dataTransfer\n            clipboard.setData 'text/html', _.map(sel.getRangeAt(0).cloneContents().childNodes, htmlForNode).join ''\n            clipboard.setData 'text/plain', @selectedText sel\n            clipboard.effectAllowed = 'copyMove'\n            clipboard.dropEffect = 'move'\n          true\n        @node[0].addEventListener 'dragend', (e)=>\n          if dr = dragRange\n            dragRange = null\n            if e.dataTransfer.dropEffect == 'move'\n              useEvent e\n              sel = @getSelectedDocRange()\n              @replace e, dr, ''\n              @selectDocRange sel\n      bindClipboard: ->\n        @node.on 'cut', (e)=>\n          useEvent e\n          sel = getSelection()\n          if sel.type == 'Range'\n            clipboard = originalEvent(e).clipboardData\n            clipboard.setData 'text/html', _.map(sel.getRangeAt(0).cloneContents().childNodes, htmlForNode).join ''\n            clipboard.setData 'text/plain', @selectedText sel\n            @replace e, @getSelectedBlockRange(), ''\n        @node.on 'copy', (e)=>\n          useEvent e\n          sel = getSelection()\n          if sel.type == 'Range'\n            clipboard = originalEvent(e).clipboardData\n            clipboard.setData 'text/html', _.map(sel.getRangeAt(0).cloneContents().childNodes, htmlForNode).join ''\n            clipboard.setData 'text/plain', @selectedText sel\n        @node.on 'paste', (e)=>\n          useEvent e\n          @replace e, @getSelectedBlockRange(), originalEvent(e).clipboardData.getData('text/plain'), false\n      bindMouse: ->\n        @node.on 'mousedown', (e)=>\n          if @lastDragRange && detail(e) == 2\n            @dragRange = @lastDragRange\n            console.log \"double click\"\n            start = @domCursor(@dragRange).mutable()\n            end = start.copy()\n            txt = start.char()\n            while true\n              start.backwardChar()\n              if !start.isEmpty() && start.type == 'text' then txt = start.char() + txt\n              if start.isEmpty() || start.type != 'text' || txt.match imbeddedBoundary\n                #start.forwardChar()\n                break\n            txt = end.char()\n            while true\n              end.forwardChar()\n              if !end.isEmpty() && end.type == 'text' then txt += end.char()\n              if end.isEmpty() || end.type != 'text' || txt.match imbeddedBoundary\n                end.backwardChar()\n                break\n            s = getSelection()\n            s.removeAllRanges()\n            @dragRange.setStart start.node, start.pos\n            @dragRange.setEnd end.node, end.pos\n            s.addRange @dragRange\n            e.preventDefault()\n          else if @dragRange = @getAdjustedCaretRange e\n            @domCursor(@dragRange).moveCaret()\n            e.preventDefault()\n          setTimeout (=>@trigger 'moved', this), 1\n          @setCurKeyBinding null\n        @node.on 'mouseup', (e)=>\n          @lastDragRange = @dragRange\n          @dragRange = null\n          @adjustSelection e\n          @trigger 'moved', this\n        @node.on 'mousemove', (e)=>\n          if @dragRange\n            s = getSelection()\n            s.removeAllRanges()\n            s.addRange @dragRange\n            r2 = @getAdjustedCaretRange e, true\n            s.extend r2.startContainer, r2.startOffset\n            e.preventDefault()\n      getAdjustedCaretRange: (e, returnUnchanged) ->\n        {node, offset} = DOMCursor.caretPos e.clientX, e.clientY\n        r2 = @domCursor(node, offset).backwardChar().range()\n        rect1 = DOMCursor.getBoundingRect(node)\n        rect2 = r2.getBoundingClientRect()\n        if rect1.top == rect2.top && rect1.bottom == rect2.bottom && rect2.left < rect1.left && e.clientX <= (rect1.left + rect2.left) / 2\n          r2\n        else if returnUnchanged then r\n      bindKeyboard: ->\n        @node.on 'keyup', (e)=> @handleKeyup e\n        @node.on 'keydown', (e)=>\n          @modCancelled = false\n          c = eventChar e\n          if !@addKeyPress e, c then return\n          s = getSelection()\n          r = s.rangeCount > 0 && s.getRangeAt(0)\n          @currentBlockIds = @blockIdsForSelection s, r\n          [bound, checkMod] = @findKeyBinding e, r\n          if bound then @modCancelled = !checkMod\n          else\n            @modCancelled = false\n            if c == ENTER then @enter e\n            else if c == BS\n              useEvent e\n              @backspace e, s, r\n            else if c == DEL\n              useEvent e\n              @del e, s, r\n            else if (modifyingKey c, e) && !isAlphabetic e\n              @char = getEventChar e\n              @keyPress e\n        @node.on 'keypress', (e)=>\n          if !e.altKey && !e.metaKey && !e.ctrlKey then @keyPress e\n      enter: (e)->\n        useEvent e\n        @replace e, @getSelectedBlockRange(), '\\n', false\n      keyPress: (e)->\n        useEvent e\n        @replace e, @getSelectedBlockRange(), null, false\n      blockIdsForSelection: (sel, r)->\n        if !sel then sel = getSelection()\n        if sel.rangeCount == 1\n          if !r then r = sel.getRangeAt 0\n          blocks = if cont = @options.getContainer(r.startContainer)\n            [@options.idForNode cont]\n          else []\n          if !r?.collapsed\n            cur = blocks[0]\n            end = @options.idForNode @options.getContainer(r.endContainer)\n            while cur && cur != end\n              if cur = (@getCopy cur).next\n                blocks.push cur\n          blocks\n      setCurKeyBinding: (f)->\n        @prevKeybinding = @curKeyBinding\n        @curKeyBinding = f\n      addKeyPress: (e, c)->\n        if notShift = !shiftKey c\n          e.DE_editorShiftkey = true\n          @lastKeys.push modifiers(e, c)\n          while @lastKeys.length > maxLastKeys\n            @lastKeys.shift()\n          @keyCombos = new Array maxLastKeys\n          for i in [0...Math.min(@lastKeys.length, maxLastKeys)]\n            @keyCombos[i] = @lastKeys[@lastKeys.length - i - 1 ... @lastKeys.length].join ' '\n          @keyCombos.reverse()\n        notShift\n      findKeyBinding: (e, r)->\n        for k in @keyCombos\n          if f = @options.bindings[k]\n            @lastKeys = []\n            @keyCombos = []\n            @setCurKeyBinding f\n            return [true, f this, e, r]\n        @setCurKeyBinding null\n        [false]\n      handleKeyup: (e)->\n        if @ignoreModCheck = @ignoreModCheck then @ignoreModCheck--\n        if @clipboardKey || (!e.DE_shiftkey && !@modCancelled && modifyingKey(eventChar(e), e))\n          @options.keyUp()\n          @clipboardKey = null\n      adjustSelection: (e)->\n        if detail(e) == 1 then return\n        s = getSelection()\n        if s.type == 'Range'\n          r = s.getRangeAt 0\n          pos = @domCursor r.endContainer, r.endOffset\n            .mutable()\n            .filterVisibleTextNodes()\n            .firstText()\n          while !pos.isEmpty() && pos.node != r.startContainer && pos.node.data.trim() == ''\n            pos = pos.prev()\n          while !pos.isEmpty() && pos.pos > 0 && pos.node.data[pos.pos - 1] == ' '\n            pos.pos--\n          if (pos.node != r.startContainer || pos.pos > r.startOffset) && (pos.node != r.endContainer || pos.pos < r.endOffset)\n            r.setEnd pos.node, pos.pos\n            selectRange r\n      moveSelectionForward: -> @showCaret @moveForward()\n      moveSelectionDown: -> @showCaret @moveDown()\n      moveSelectionBackward: -> @showCaret @moveBackward()\n      moveSelectionUp: -> @showCaret @moveUp()\n      showCaret: (pos)->\n        if pos.isEmpty() then pos = pos.prev()\n        pos = @domCursorForCaret()\n        pos.moveCaret()\n        #(if pos.node.nodeType == pos.node.TEXT_NODE then pos.node.parentNode else pos.node).scrollIntoView()\n        @makeElementVisible pos.node\n        @trigger 'moved', this\n      moveForward: ->\n        sel = getSelection()\n        offset = if sel.type == 'None' then 0\n        else\n          r = sel.getRangeAt(0)\n          offset = if r.endContainer == r.startContainer\n            @docOffset r.endContainer, Math.max r.startOffset, r.endOffset\n          else @docOffset r.endContainer, r.endOffset\n        start = pos = @domCursorForCaret().firstText().save()\n        if !pos.isEmpty() && @options.isValidDocOffset(offset) && (@domCursorForCaret().firstText().equals(start) || pos.isCollapsed())\n          pos = @domCursorForDocOffset offset\n          while !pos.isEmpty() && (@domCursorForCaret().firstText().equals(start) || pos.isCollapsed())\n            if pos.isCollapsed()\n              pos.next().moveCaret()\n            else pos.forwardChars(1).moveCaret()\n        if pos.isEmpty()\n          offset = @options.getLength() - 1\n          pos = @domCursorForDocOffset(offset).firstText()\n          while !pos.isEmpty() && pos.isCollapsed()\n            pos = @domCursorForDocOffset --offset\n        else if !@options.isValidDocOffset(offset)\n          pos = start\n        pos.moveCaret()\n      moveBackward: ->\n        sel = getSelection()\n        offset = if sel.type == 'None' then 0\n        else\n          r = sel.getRangeAt(0)\n          offset = if r.endContainer == r.startContainer\n            @docOffset r.endContainer, Math.min r.startOffset, r.endOffset\n          else @docOffset r.startContainer, r.startOffset\n        start = pos = @domCursorForCaret().firstText().save()\n        if !pos.isEmpty() && (@domCursorForCaret().firstText().equals(start) || pos.isCollapsed())\n          pos = @domCursorForDocOffset offset\n          while !pos.isEmpty() && (@domCursorForCaret().firstText().equals(start) || pos.isCollapsed())\n            if pos.isCollapsed()\n              pos.prev()\n            else pos.backwardChar().moveCaret()\n        if pos.isEmpty()\n          offset = 0\n          pos = @domCursorForDocOffset(offset).firstText()\n          while !pos.isEmpty() && pos.isCollapsed()\n            pos = @domCursorForDocOffset ++offset\n        pos.moveCaret()\n      firstText: -> @domCursor(@node, 0).firstText().node\n      moveDown: ->\n        linePos = prev = pos = @domCursorForCaret().save()\n        if !(@prevKeybinding in [keyFuncs.nextLine, keyFuncs.previousLine])\n          @movementGoal = @options.blockColumn pos\n          line = 0\n        else line = (if pos.pos == 0 && pos.node == @firstText() && @options.blockColumn(pos) < @movementGoal then 1 else 0)\n        lineTop = posFor(linePos).top\n        lastPos = @docOffset(pos) - 1\n        while !(pos = @moveForward()).isEmpty() && (docPos = @docOffset(pos)) != lastPos\n          lastPos = docPos\n          p = posFor(pos)\n          if lineTop < p.top\n            line++\n            pos = linePos = p.pos\n            lineTop = p.top\n          if line == 2 then return prev.moveCaret()\n          if line == 1 && @options.blockColumn(pos) >= @movementGoal\n            return @moveToBestPosition pos, prev, linePos\n          prev = pos\n        pos\n      moveUp: ->\n        linePos = prev = pos = @domCursorForCaret().save()\n        if !(@prevKeybinding in [keyFuncs.nextLine, keyFuncs.previousLine]) then @movementGoal = @options.blockColumn pos\n        line = 0\n        lastPos = @options.getLength()\n        while !(pos = @moveBackward()).isEmpty() && (docPos = @docOffset pos) != lastPos\n          lastPos = docPos\n          if linePos.differentLines pos\n            line++\n            linePos = pos\n          if line == 2 then return prev.moveCaret()\n          if line == 1 && @options.blockColumn(pos) <= @movementGoal\n            return @moveToBestPosition pos, prev, linePos\n          prev = pos\n        pos\n\n`moveToBestPosition(pos, prev, linePos)` tries to move the caret to the best position in the HTML text.  If pos is closer to the goal, return it, otherwise move to prev and return prev.\n\n      moveToBestPosition: (pos, prev, linePos)->\n        if linePos == pos || Math.abs(@options.blockColumn(pos) - @movementGoal) < Math.abs(@options.blockColumn(prev) - @movementGoal)\n          pos\n        else prev.moveCaret()\n\nSet html of an element and evaluate scripts so that document.currentScript is properly set\n\n      setHtml: (el, html, outer)->\n        if outer\n          prev = el.previousSibling\n          next = el.nextSibling\n          par = el.parentNode\n          el.outerHTML = html\n          el = prev?.nextSibling ? next?.previousSibling ? par?.firstChild\n        else el.innerHTML = html\n        @activateScripts $(el)\n        el\n\n      activateScripts: (jq)->\n        if !activating\n          activating = true\n          try\n            for script in jq.find('script')\n              text = if !script.type || script.type.toLowerCase() == 'text/javascript'\n                script.textContent\n              else if script.type.toLowerCase() == 'text/coffeescript'\n                CoffeeScript.compile script.textContent, bare: true\n              else if script.type.toLowerCase() == 'text/literate-coffeescript'\n                CoffeeScript.compile script.textContent, bare: true, literate: true\n              if text\n                newScript = document.createElement 'script'\n                newScript.type = 'text/javascript'\n                if script.src then newScript.src = script.src\n                newScript.textContent = text\n                @setCurrentScript newScript\n                script.parentNode.insertBefore newScript, script\n                script.parentNode.removeChild script\n          finally\n            @setCurrentScript null\n            activating = false\n\n      setCurrentScript: (script)->\n        LeisureEditCore.currentScript = null\n\n    eventChar = (e)-> e.charCode || e.keyCode || e.which\n\n    isAlphabetic = (e)-> !e.altKey && !e.ctrlKey && !e.metaKey && (64 < eventChar(e) < 91)\n\n#BasicEditingOptions class\n#=========================\n#BasicEditingOptions is an the options base class.\n#\n#Events:\n#  `load`: new text was loaded into the editor\n#\n#Hook methods (required)\n#-----------------------\n#\n#`renderBlock(block) -> [html, next]`: render a block (and potentially its children) and return the HTML and the next blockId if there is one\n#\n#  * Block DOM (DOM for a block) must be a single element with the same id as the block.\n#  * Block DOM may contain nested block DOM.\n#  * each block's DOM should have the same id as the block and have a data-block attribute\n#  * non-editable parts of the DOM should have contenteditable=false\n#  * completely skipped parts should be non-editable and have a data-noncontent attribute\n#\n#Properties of BasicEditingOptions\n#---------------------------------\n#* `blocks {id -> block}`: block table\n#* `first`: id of first block\n#* `bindings {keys -> binding(editor, event, selectionRange)}`: a map of bindings (can use LeisureEditCore.defaultBindings)\n#\n#Methods of BasicEditingOptions\n#------------------------------\n#* `getBlock(id) -> block?`: get the current block for id\n#* `getContainer(node) -> Node?`: get block DOM node containing for a node\n#* `getFirst() -> blockId`: get the first block id\n#* `domCursor(node, pos) -> DOMCursor`: return a domCursor that skips over non-content\n#* `keyUp(editor) -> void`: handle keyup after-actions\n#* `topRect() -> rect?`: returns null or the rectangle of a toolbar at the page top\n#* `blockColumn(pos) -> colNum`: returns the start column on the page for the current block\n#* `load(el, text) -> void`: parse text into blocks and replace el's contents with rendered DOM\n#\n#    class BasicEditingOptionsOld extends Observable\n#\n#      renderBlock: (block)-> throw new Error \"options.renderBlock(block) is not implemented\"\n#\n#Hook methods (optional)\n#-----------------------\n#\n#`simulateCut({html, text})`: The editor calls this when the user hits backspace or delete on selected text.\n#\n#      simulateCut: ({html, text})->\n#\n#`dragEnter(event)`: alter the drag-enter behavior.  If you want to cancel the drag, for\n#instance, call event.preventDefault() and set the dropEffect to 'none'\n#\n#      dragEnter: (event)->\n#        if !event.dataTransfer.getData\n#          useEvent event\n#          event.dropEffect = 'none'\n#\n#`dragOver(event)`: alter the drag-enter behavior.  If you want to cancel the drag, for\n#instance, call event.preventDefault() and set the dropEffect to 'none'\n#\n#      dragOver: (event)->\n#        if !event.dataTransfer.getData\n#          useEvent event\n#          event.dropEffect = 'none'\n#\n#Main code\n#---------\n#\n#      constructor: ->\n#        super()\n#        @changeContext = null\n#        @initData()\n#\n#      setDiagEnabled: (flag)->\n#        #changeAdvice this, flag,\n#        #  renderBlocks: diag: wrapDiag\n#        #  changed: diag: wrapDiag\n#        #if flag then @diag()\n#\n#      diag: -> @trigger 'diag', @editor.verifyAllNodes()\n#\n#      initData: ->\n#\n#`blocks {id -> block}`: block table\n#\n#        @blocks = {}\n#\n#`first`: id of first block\n#\n#        @first = null\n#\n#`getFirst() -> blockId`: get the first block id\n#\n#      getFirst: -> @first\n#      nodeForId: (id)-> $(\"##{id}\")\n#      idForNode: (node)-> $(node).prop 'id'\n#      setEditor: (@editor)->\n#      newId: -> @data.newId()\n#\n#`changeStructure(oldBlocks, newText)`: Compute blocks affected by transforming oldBlocks into newText\n#\n#      changeStructure: (oldBlocks, newText)->\n#        computeNewStructure this, oldBlocks, newText\n#      mergeChangeContext: (obj)-> @changeContext = _.merge {}, @changeContext ? {}, obj\n#      clearChangeContext: -> @changeContext = null\n#\n#`getBlock(id) -> block?`: get the current block for id\n#\n#      getBlock: (id)-> @blocks[id]\n#\n#`bindings {keys -> binding(editor, event, selectionRange)}`: a map of bindings (can use LeisureEditCore.defaultBindings)\n#\n#      bindings: defaultBindings\n#\n#`blockColumn(pos) -> colNum`: returns the start column on the page for the current block\n#\n#      blockColumn: (pos)-> pos.textPosition().left\n#\n#`topRect() -> rect?`: returns null or the rectangle of a toolbar at the page top\n#\n#      topRect: -> null\n#\n#`keyUp(editor) -> void`: handle keyup after-actions\n#\n#      keyUp: ->\n#\n#`domCursor(node, pos) -> DOMCursor`: return a domCursor that skips over non-content\n#\n#      domCursor: (node, pos)->\n#        new DOMCursor(node, pos).addFilter (n)-> (n.hasAttribute('data-noncontent') && 'skip') || true\n#\n#`getContainer(node) -> Node?`: get block DOM node containing for a node\n#\n#      getContainer: (node)->\n#        if @editor.node[0].compareDocumentPosition(node) & Element.DOCUMENT_POSITION_CONTAINED_BY\n#          $(node).closest('[data-block]')[0]\n#\n#`load(name, text) -> void`: parse text into blocks and trigger a 'load' event\n#\n#      load: (name, text)->\n#        @options.suppressTriggers =>\n#          @options.data.suppressTriggers =>\n#            @replaceText {start: 0, end: @getLength(), text, source: 'edit'}\n#        @rerenderAll()\n#        @trigger 'load'\n#      rerenderAll: ->\n#        @editor.setHtml @editor.node[0], @renderBlocks()\n#        if result = @validatePositions()\n#          console.error \"DISCREPENCY AT POSITION #{result.block._id}, #{result.offset},\",\n#      blockCount: ->\n#        c = 0\n#        for b of @blocks\n#          c++\n#        c\n#      blockList: ->\n#        next = @getFirst()\n#        while next\n#          bl = @getBlock next\n#          next = bl.next\n#          bl\n#      docOffsetForBlockOffset: (bOff, offset)-> @data.docOffsetForBlockOffset bOff, offset\n#      blockOffsetForDocOffset: (dOff)-> @data.blockOffsetForDocOffset dOff\n#      getPositionForBlock: (block)->\n#        cur = @getBlock @getFirst()\n#        offset = 0\n#        while cur._id != block._id\n#          offset += cur.text.length\n#          cur = @getBlock cur.next\n#        offset\n#      getBlockOffsetForPosition: (pos)->\n#        cur = @getBlock @getFirst()\n#        while pos >= cur.text.length\n#          pos -= cur.text.length\n#          cur = @getBlock cur.next\n#        block: cur\n#        offset: pos\n#      renderBlocks: ->\n#        result = ''\n#        next = @getFirst()\n#        while next && [html, next] = @renderBlock @getBlock next\n#          result += html\n#        result\n#      getText: ->\n#        text = ''\n#        block = @data.getBlock @data.getFirst()\n#        while block\n#          text += block.text\n#          block = @data.getBlock block.next\n#        text\n#      getLength: ->\n#        len = 0\n#        block = @data.getBlock @data.getFirst()\n#        while block\n#          len += block.text.length\n#          block = @data.getBlock block.next\n#        len\n#      isValidDocOffset: (offset)-> 0 <= offset <= @getLength()\n#      validatePositions: ->\n#        block = @data.getBlock @data.getFirst()\n#        while block\n#          if node = @nodeForId(block._id)[0]\n#            cursor = @domCursor(node, 0).mutable()\n#            for offset in [0...block.text.length]\n#              cursor = cursor.firstText()\n#              if cursor.isEmpty() || !sameCharacter cursor.character(), block.text[offset]\n#                return {block, offset}\n#              cursor.forwardChar()\n#          block = @data.getBlock block.next\n\n    #export BasicEditingOptions = BasicEditingOptionsOld\n    export BasicEditingOptions = BasicEditingOptionsNew\n\n    #spaces = String.fromCharCode( 32, 160)\n\n    #export sameCharacter = (c1, c2)-> c1 == c2 || ((c1 in spaces) && (c2 in spaces))\n\n    #export computeNewStructure = (access, oldBlocks, newText)->\n    #  prev = oldBlocks[0]?.prev ? 0\n    #  oldBlocks = oldBlocks.slice()\n    #  oldText = null\n    #  offset = 0\n    #  if oldBlocks.length\n    #    while oldText != newText && (oldBlocks[0].prev || last(oldBlocks).next)\n    #      oldText = newText\n    #      if prev = access.getBlock oldBlocks[0].prev\n    #        oldBlocks.unshift prev\n    #        newText = prev.text + newText\n    #        offset += prev.text.length\n    #      if next = access.getBlock last(oldBlocks).next\n    #        oldBlocks.push next\n    #        newText += next.text\n    #      newBlocks = access.parseBlocks newText\n    #      if (!prev || prev.text == newBlocks[0].text) && (!next || next.text == last(newBlocks).text)\n    #        break\n    #  if !newBlocks then newBlocks = access.parseBlocks newText\n    #  while oldBlocks.length && newBlocks.length && oldBlocks[0].text == newBlocks[0].text\n    #    offset -= oldBlocks[0].text.length\n    #    prev = oldBlocks[0]._id\n    #    oldBlocks.shift()\n    #    newBlocks.shift()\n    #  while oldBlocks.length && newBlocks.length && last(oldBlocks).text == last(newBlocks).text\n    #    oldBlocks.pop()\n    #    newBlocks.pop()\n    #  oldBlocks: oldBlocks, newBlocks: newBlocks, offset: offset, prev: prev\n\n    #export copyBlock = (block)-> if !block then null else Object.assign {}, block\n\n    activating = false\n\n#DataStore\n#=========\n#An efficient block storage mechanism used by DataStoreEditingOptions\n#\n#Hook methods -- you must define these in your subclass\n#------------------------------------------------------\n#* `parseBlocks(text) -> blocks`: parse text into array of blocks -- DO NOT provide _id, prev, or next, they may be overwritten!\n#\n#Events\n#------\n#Data objects support the Observable protocol and emit change events in response to data changes\n#\n#`change {adds, updates, removes, oldFirst, old}`\n#\n#  * `oldFirst id`: the previous first (might be the same as the current)\n#  * `adds {id->true}`: added items\n#  * `updates {id->true}`: updated items\n#  * `removes {id->true}`: removed items\n#  * `old {id->old block}`: the old items from updates and removes\n#\n#Internal API -- provide/override these if you want to change how the store accesses data\n#----------------------------------------------------------------------------------------\n#\n#* `getFirst()`\n#* `setFirst(firstId)`\n#* `getBlock(id)`\n#* `setBlock(id, block)`\n#* `deleteBlock(id)`\n#* `eachBlock(func(block [, id]))` -- iterate with func (exit if func returns false)\n#* `load(first, blocks)` -- should trigger 'load'\n#\n#External API -- used from outside; alternative data objects must support these methods.\n#---------------------------------------------------------------------------------------\n#\n#In addition to the methods below, data objects must support the Observable protocol and emit\n#change events in response to data changes\n#\n#* `getFirst() -> id`: id of the first block\n#* `getBlock(id) -> block`: the block for id\n#* `load(name, text)`: replace the current document\n#* `newId()`:\n#* `docOffsetForBlockOffset(args...) -> offset`: args can be a blockOffset or block, offset\n#* `blockOffsetForDocOffset(offset) -> blockOffset`: the block offset for a position in the document\n#* `suppressTriggers(func) -> func's return value`: suppress triggers while executing func (inherited from Observable)\n#\n#<!-- -->\n#\n#    export class DataStore extends Observable\n#      constructor: ->\n#        super()\n#        @blocks = {}\n#        @blockIndex = @newBlockIndex()\n#        @changeCount = 0\n#        @clearMarks()\n#        @markNames = {}\n#      load: (name, text)->\n#        blockMap = {}\n#        newBlocks = @parseBlocks text\n#        for block, i in newBlocks\n#          block._id = @newId()\n#          blockMap[block._id] = block\n#          if prev = newBlocks[i - 1]\n#            prev.next = block._id\n#            block.prev = prev._id\n#        @first = newBlocks[0]?._id\n#        @blocks = blockMap\n#        @makeChanges =>\n#          @indexBlocks()\n#          @trigger 'load'\n#\n#`parseBlocks(text) -> blocks`: parse text into array of blocks -- DO NOT provide _id, prev, or next, they may be overwritten!\n#\n#      parseBlocks: (text)-> throw new Error \"options.parseBlocks(text) is not implemented\"\n#\n#      newBlockIndex: (contents)-> FingerTree.fromArray contents ? [],\n#        identity: -> ids: Set(), length: 0\n#        measure: (v)-> ids: Set([v.id]), length: v.length\n#        sum: (a, b)-> ids: a.ids.union(b.ids), length: a.length + b.length\n#      newId: -> \"block#{idCounter++}\"\n#      setDiagEnabled: (flag)->\n#        #changeAdvice this, flag,\n#        #  makeChanges: diag: afterMethod ->\n#        #    if @changeCount == 0 then @diag()\n#        #if flag then @diag()\n#\n#`getLength() -> number`: the length of the entire document\n#\n#      getLength: -> @blockIndex.measure().length\n#      makeChanges: (func)->\n#        @changeCount++\n#        try\n#          func()\n#        finally\n#          @changeCount--\n#      clearMarks: -> @marks = FingerTree.fromArray [],\n#        identity: -> names: Set(), length: 0\n#        measure: (n)-> names: Set([n.name]), length: n.offset\n#        sum: (a, b)-> names: a.names.union(b.names), length: a.length + b.length\n#      addMark: (name, offset)->\n#        if @markNames[name] then @removeMark name\n#        @markNames[name] = true\n#        [first, rest] = @marks.split (m)-> m.length >= offset\n#        l = first.measure().length\n#        if !rest.isEmpty()\n#          n = rest.peekFirst()\n#          rest = rest.removeFirst().addFirst\n#            offset: l + n.offset - offset\n#            name: n.name\n#        @marks = first.concat rest.addFirst\n#          offset: offset - l\n#          name: name\n#      removeMark: (name)-> if @markNames[name]\n#        delete @markNames[name]\n#        [first, rest] = @marks.split (m)-> m.names.contains name\n#        if !rest.isEmpty()\n#          removed = rest.peekFirst()\n#          rest = rest.removeFirst()\n#          if !rest.isEmpty()\n#            n = rest.peekFirst()\n#            rest = rest.removeFirst()\n#              .addFirst offset: removed.offset + n.offset, name: n.name\n#        @marks = first.concat rest\n#      listMarks: ->\n#        m = []\n#        t = @marks\n#        while !t.isEmpty()\n#          n = t.peekFirst()\n#          m.push _.defaults {location: @getMarkLocation n.name}, n\n#          t = t.removeFirst()\n#        m\n#      getMarkLocation: (name)-> if @markNames[name]\n#        [first, rest] = @marks.split (m)-> m.names.contains name\n#        if !rest.isEmpty() then first.measure().length + rest.peekFirst().offset\n#      blockOffsetForMark: (name)-> if offset = @getMarkLocation name\n#        @blockOffsetForDocOffset offset\n#      floatMarks: (start, end, newLength)-> if newLength != oldLength = end - start\n#        [first, rest] = @marks.split (m)-> m.length > start\n#        if !rest.isEmpty()\n#          n = rest.peekFirst()\n#          @marks = first.concat rest.removeFirst().addFirst\n#            name: n.name\n#            offset: n.offset + newLength - oldLength\n#      replaceText: ({start, end, text})->\n#        {prev, oldBlocks, newBlocks} = @changesForReplacement start, end, text\n#        if oldBlocks\n#          @change @changesFor prev, oldBlocks.slice(), newBlocks.slice()\n#          @floatMarks start, end, text.length\n#      changesForReplacement: (start, end, text)->\n#        {blocks, newText} = @blockOverlapsForReplacement start, end, text\n#        {oldBlocks, newBlocks, offset, prev} = change = computeNewStructure this, blocks, newText\n#        if oldBlocks.length || newBlocks.length then change else {}\n#      computeRemovesAndNewBlockIds: (oldBlocks, newBlocks, newBlockMap, removes)->\n#        for oldBlock in oldBlocks[newBlocks.length...oldBlocks.length]\n#          removes[oldBlock._id] = oldBlock\n#        prev = null\n#        for newBlock, i in newBlocks\n#          if oldBlock = oldBlocks[i]\n#            newBlock._id = oldBlock._id\n#            newBlock.prev = oldBlock.prev\n#            newBlock.next = oldBlock.next\n#          else\n#            newBlock._id = @newId()\n#            if prev then link prev, newBlock\n#          prev = newBlockMap[newBlock._id] = newBlock\n#        prev\n#      patchNewBlocks: (first, oldBlocks, newBlocks, changes, newBlockMap, removes, prev)->\n#        if !oldBlocks.length && first = @getBlock first\n#          oldNext = @getBlock first.next\n#          oldBlocks.unshift first\n#          first = newBlockMap[first._id] = copyBlock first\n#          link first, newBlocks[0]\n#          newBlocks.unshift first\n#          if oldNext\n#            oldBlocks.push oldNext\n#            oldNext = newBlockMap[oldNext._id] = copyBlock oldNext\n#            link last(newBlocks), oldNext\n#            newBlocks.push oldNext\n#        else if oldBlocks.length != newBlocks.length\n#          if !prev && prev = copyBlock oldPrev = @getBlock oldBlocks[0].prev\n#            oldBlocks.unshift oldPrev\n#            newBlocks.unshift prev\n#            newBlockMap[prev._id] = prev\n#          lastBlock = last oldBlocks\n#          if next = copyBlock oldNext = @getBlock (if lastBlock then lastBlock.next else @getFirst())\n#            oldBlocks.push oldNext\n#            newBlocks.push next\n#            newBlockMap[next._id] = next\n#            if !(next.prev = prev?._id) then changes.first = next._id\n#          if prev\n#            if !first && ((newBlocks.length && !newBlocks[0].prev) || !oldBlocks.length || !@getFirst() || removes[@getFirst()])\n#              changes.first = newBlocks[0]._id\n#            prev.next = next?._id\n#      changesFor: (first, oldBlocks, newBlocks)->\n#        newBlockMap = {}\n#        removes = {}\n#        changes = {removes, sets: newBlockMap, first: @getFirst(), oldBlocks, newBlocks}\n#        prev = @computeRemovesAndNewBlockIds oldBlocks, newBlocks, newBlockMap, removes\n#        @patchNewBlocks first, oldBlocks, newBlocks, changes, newBlockMap, removes, prev\n#        @removeDuplicateChanges newBlockMap\n#        changes\n#      removeDuplicateChanges: (newBlockMap)->\n#        dups = []\n#        for id, block of newBlockMap\n#          if (oldBlock = @getBlock id) && block.text == oldBlock.text && block.next == oldBlock.next && block.prev == oldBlock.prev\n#            dups.push id\n#        for id of dups\n#          delete newBlockMap[id]\n#      checkChanges: -> if @changeCount == 0\n#        throw new Error \"Attempt to make a change outside of makeChanges\"\n#      setIndex: (i)->\n#        @checkChanges()\n#        @blockIndex = i\n#      getFirst: -> @first\n#      setFirst: (firstId)-> @first = firstId\n#      getBlock: (id)-> @blocks[id]\n#      setBlock: (id, block)->\n#        @checkChanges()\n#        @blocks[id] = block\n#        @indexBlock block\n#      deleteBlock: (id)->\n#        @checkChanges()\n#        delete @blocks[id]\n#        @unindexBlock id\n#      eachBlock: (func)->\n#        block = @getBlock @getFirst()\n#        while block && func(block, block._id) != false\n#          block = @getBlock block.next\n#        null\n#      indexBlocks: ->\n#        @checkChanges()\n#        items = []\n#        @eachBlock (block)=> items.push indexNode block\n#        @setIndex @newBlockIndex items\n#      splitBlockIndexOnId: (id)-> @blockIndex.split (m)-> m.ids.contains id\n#      splitBlockIndexOnOffset: (offset)-> @blockIndex.split (m)-> m.length > offset\n#      indexBlock: (block)-> if block\n#        @checkChanges()\n#        # if the block is indexed, it might be an easy case, otherwise unindex it\n#        [first, rest] = @splitBlockIndexOnId block._id\n#        if !rest.isEmpty() && rest.peekFirst().id == block._id &&\n#          (next = rest.removeFirst()) &&\n#          (if next.isEmpty() then !block.next else next.peekFirst().id == block.next) &&\n#          (if first.isEmpty() then !block.prev else first.peekLast().id == block.prev)\n#            return @setIndex first.addLast(indexNode block).concat next\n#        if !rest.isEmpty() then @unindexBlock block._id\n#        # if next is followed by prev, just insert the block in between\n#        if (split = @fingerNodeOrder(block.prev, block.next)) && _.isArray split\n#          [first, rest] = split\n#          return @setIndex first.addLast(indexNode block).concat rest\n#        # repair as much of the index as possible and insert the block\n#        @insertAndRepairIndex block\n#      fingerNode: (id)->\n#        id && (node = @splitBlockIndexOnId(id)[1].peekFirst()) && node.id == id && node\n#      fingerNodeOrder: (a, b)->\n#        return !(a || b) ||\n#        if !a && b then @fingerNode b\n#        else if !b && a then @fingerNode a\n#        else\n#          [first, rest] = split = @splitBlockIndexOnId b\n#          !first.isEmpty() && !rest.isEmpty() && rest.peekFirst()?.id == b && first.peekLast()?.id == a && split\n#      # insert block into the index\n#      # then trace forwards and backwards, repairing along the way\n#      insertAndRepairIndex: (block)->\n#        console.warn \"REPAIR\"\n#        node = indexNode block\n#        if block.next\n#          prev = @getBlock block.prev\n#          if !block.prev\n#            @setIndex @blockIndex.addFirst indexNode block\n#          else\n#            [first, rest] = @splitBlockIndexOnId block.next\n#            @setIndex first.addLast(node).concat rest\n#        else if block.prev\n#          [first, rest] = @splitBlockIndexOnId block.prev\n#          @setIndex first.addLast(node).concat rest\n#        else @setIndex @newBlockIndex [node]\n#        mark = block\n#        cur = @getBlock block.next\n#        while cur && !@fingerNodeOrder mark._id, cur._id\n#          @unindexBlock cur._id\n#          [first, rest] = @splitBlockIndexOnId mark._id\n#          @setIndex insertAfterSplit first, indexNode(cur), rest\n#          mark = cur\n#          cur = @getBlock cur.next\n#        mark = block\n#        cur = @getBlock block.prev\n#        while cur && !@fingerNodeOrder cur._id, mark._id\n#          @unindexBlock cur._id\n#          [first, rest] = @splitBlockIndexOnId mark._id\n#          @setIndex insertInSplit first, indexNode(cur), rest\n#          mark = cur\n#          cur = @getBlock cur.prev\n#      unindexBlock: (id)->\n#        @checkChanges()\n#        if id\n#          [first, rest] = @splitBlockIndexOnId id\n#          if rest.peekFirst()?.id == id\n#            @setIndex first.concat rest.removeFirst()\n#\n#`docOffsetForBlockOffset(args...) -> offset`: args can be a blockOffset or block, offset\n#\n#      docOffsetForBlockOffset: (block, offset)->\n#        if typeof block == 'object'\n#          offset = block.offset\n#          block = block.block\n#        @offsetForBlock(block) + offset\n#      blockOffsetForDocOffset: (offset)->\n#        results = @splitBlockIndexOnOffset offset\n#        if !results[1].isEmpty()\n#          block: results[1].peekFirst().id\n#          offset: offset - results[0].measure().length\n#        else\n#          block: results[0].peekLast().id\n#          offset: results[0].removeLast().measure().length\n#      offsetForBlock: (blockOrId)->\n#        id = if typeof blockOrId == 'string' then blockOrId else blockOrId._id\n#        if @getBlock id then @splitBlockIndexOnId(id)[0].measure().length else 0\n#      blockForOffset: (offset)->\n#        results = @splitBlockIndexOnOffset offset\n#        (results[1]?.peekFirst() ? results[0].peekLast).id\n#      getDocLength: -> @blockIndex.measure().length\n#      getDocSubstring: (start, end)->\n#        startOffset = @blockOffsetForDocOffset start\n#        endOffset = @blockOffsetForDocOffset end\n#        block = @getBlock startOffset.block\n#        text = ''\n#        while block._id != endOffset.block\n#          text += block.text\n#          block = @getBlock block.next\n#        if startOffset.block == endOffset.block\n#          block.text.substring startOffset.offset, endOffset.offset\n#        else text.substring(startOffset.offset) + block.text.substring 0, endOffset.offset\n#\n#`getText(): -> string`: the text for the entire document\n#\n#      getText: ->\n#        text = ''\n#        @eachBlock (block)-> text += block.text\n#        text\n#      check: ->\n#        seen = {}\n#        first = next = @getFirst()\n#        prev = null\n#        while next\n#          prev = next\n#          if seen[next] then throw new Error \"cycle in next links\"\n#          seen[next] = true\n#          oldBl = bl\n#          bl = @getBlock next\n#          if !bl then throw new Error \"Next of #{oldBl._id} doesn't exist\"\n#          next = bl.next\n#        @eachBlock (block)->\n#          if block._id != first && !seen[block._id] then throw new Error \"#{block._id} not in next chain\"\n#        seen = {}\n#        lastBlock = prev\n#        while prev\n#          if seen[prev] then throw new Error \"cycle in prev links\"\n#          seen[prev] = true\n#          oldBl = bl\n#          bl = @getBlock prev\n#          if !bl then throw new Error \"Prev of #{oldBl._id} doesn't exist\"\n#          prev = bl.prev\n#        @eachBlock (block)->\n#          if block._id != lastBlock && !seen[block._id] then throw new Error \"#{block._id} not in prev chain\"\n#        null\n#      blockList: ->\n#        next = @getFirst()\n#        while next\n#          bl = @getBlock next\n#          next = bl.next\n#          bl\n#      change: (changes)-> @trigger 'change', @makeChange changes\n#      makeChange: ({first, sets, removes, oldBlocks, newBlocks})->\n#        @makeChanges =>\n#          {adds, updates, old} = result = {adds: {}, updates: {}, removes, old: {}, sets, oldFirst: @getFirst(), first: first, oldBlocks, newBlocks}\n#          @setFirst first\n#          for id of removes\n#            if bl = @getBlock id\n#              old[id] = bl\n#              @deleteBlock id\n#          for id, block of sets\n#            if bl = @getBlock id\n#              old[id] = bl\n#              updates[id] = block\n#            else adds[id] = block\n#            @setBlock id, block\n#          try\n#            @check()\n#          catch err\n#            console.log err\n#          result\n#      indexArray: -> treeToArray @blockIndex\n#      blockArray: ->\n#        blocks = []\n#        block = @getBlock @getFirst()\n#        while block\n#          blocks.push block\n#          block = @getBlock block.next\n#        blocks\n#      diag: -> @trigger 'diag', @verifyIndex()\n#      verifyIndex: ->\n#        iArray = @indexArray()\n#        treeIds = _.map iArray, _.property 'id'\n#        bArray = @blockArray()\n#        blockIds = _.map bArray, _.property '_id'\n#        if !_.isEqual treeIds, blockIds\n#          console.warn \"INDEX ERROR:\\nEXPECTED: #{JSON.stringify blockIds}\\nBUT GOT: #{JSON.stringify treeIds}\"\n#        last = null\n#        errs = new BlockErrors()\n#        for node in iArray\n#          if node.length != @getBlock(node.id)?.text.length\n#            errs.badId node.id, 'bad index length'\n#        offset = 0\n#        @eachBlock (block)=>\n#          last = block\n#          if !@fingerNodeOrder block.prev, block._id\n#            errs.badId block._id, 'bad order'\n#            console.warn \"NODE ORDER WRONG FOR #{block.prev}, #{block._id}\"\n#          if offset != @offsetForBlock block._id\n#            errs.badId block._id, \"offset\"\n#          if block.prev && @blockForOffset(offset - 1) != block.prev\n#            errs.badId block._id, \"prev\"\n#          if block.next && @blockForOffset(offset + block.text.length) != block.next\n#            errs.badId block._id, \"next\"\n#          offset += block.text.length\n#        errs.errors()\n#      blockOverlapsForReplacement: (start, end, text)->\n#        startBlock = @getBlock @blockForOffset(start)\n#        if !startBlock && start then startBlock = @getBlock @blockForOffset(start - 1)\n#        endBlock = @getBlock @blockForOffset end\n#        if !endBlock && end then endBlock = @getBlock @blockForOffset(end - 1)\n#        blocks = [startBlock]\n#        cur = startBlock\n#        while cur != endBlock && cur.next\n#          blocks.push cur = @getBlock cur.next\n#        fullText = blockText blocks\n#        offset = @offsetForBlock blocks[0]\n#        blocks: blocks\n#        blockText: fullText\n#        newText: fullText.substring(0, start - offset) + text + (fullText.substring end - offset)\n#\n#    class BlockErrors\n#      constructor: ->\n#        @order = []\n#        @ids = {}\n#      isEmpty: -> !@order.length\n#      badId: (id, msg)->\n#        if !@ids[id]\n#          @order.push id\n#          @ids[id] = msg\n#        else @ids[id] += \", #{msg}\"\n#      errors: -> if !@isEmpty() then [id, \"(#{@ids[id]})\"] for id in @order\n#\n#    export treeToArray = (tree)->\n#      nodes = []\n#      while !tree.isEmpty()\n#        nodes.push tree.peekFirst()\n#        tree = tree.removeFirst()\n#      nodes\n#\n#    indexNode = (block)-> id: block._id, length: block.text.length\n#\n#    insertInSplit = (first, middle, rest)->\n#      if first.isEmpty() then rest.addFirst middle\n#      else if rest.isEmpty() then first.addLast middle\n#      else first.addLast(middle).concat rest\n#\n#    insertAfterSplit = (first, afterMiddle, rest)->\n#      next = rest.removeFirst().addFirst(afterMiddle)\n#      if first.isEmpty() then next.addFirst rest.peekFirst()\n#      else first.addLast(rest.peekFirst()).concat next\n\nDataStoreEditingOptions\n=======================\n\n    export class DataStoreEditingOptions extends BasicEditingOptions\n      constructor: (@data)->\n        super()\n        @callbacks = {}\n        @addDataCallbacks\n          change: (changes)=> @dataChanged changes\n          load: => @dataLoaded()\n      addDataCallbacks: (cb)->\n        for type, func of cb\n          @data.on type, @callbacks[type] = func\n      dataChanged: (changes)-> preserveSelection => @changed changes\n      dataLoaded: -> @trigger 'load'\n      cleanup: -> @data.off @callbacks\n      initData: ->\n      load: (name, text)-> @data.load name, text\n      replaceText: (repl)-> @data.replaceText repl\n      getBlock: (id)-> @data.getBlock id\n      getFirst: (first)-> @data.getFirst()\n      change: (changes)-> if changes then @data.change changes\n      changed: (changes)-> @rerenderAll()\n      offsetForBlock: (blockOrId)-> @data.offsetForBlock blockOrId\n\nUtilities\n=========\n\n    export isEditable = (n)->\n      n = if n.nodeType == n.TEXT_NODE then n.parentNode else n\n      n.isContentEditable\n\n#    export link = (prev, next)->\n#      prev.next = next._id\n#      next.prev = prev._id\n\n    export blockText = (blocks)-> (block.text for block in blocks).join ''\n\ngetEventChar(e)\n--------------\nadapted from Vega on [StackOverflow](http://stackoverflow.com/a/13127566/1026782)\n\n    _to_ascii =\n      '188': '44'\n      '109': '45'\n      '190': '46'\n      '191': '47'\n      '192': '96'\n      '220': '92'\n      '222': '39'\n      '221': '93'\n      '219': '91'\n      '173': '45'\n      '187': '61' #IE Key codes\n      '186': '59' #IE Key codes\n      '189': '45' #IE Key codes\n\n    shiftUps =\n      \"96\": \"~\"\n      \"49\": \"!\"\n      \"50\": \"@\"\n      \"51\": \"#\"\n      \"52\": \"$\"\n      \"53\": \"%\"\n      \"54\": \"^\"\n      \"55\": \"&\"\n      \"56\": \"*\"\n      \"57\": \"(\"\n      \"48\": \")\"\n      \"45\": \"_\"\n      \"61\": \"+\"\n      \"91\": \"{\"\n      \"93\": \"}\"\n      \"92\": \"|\"\n      \"59\": \":\"\n      \"39\": \"\\\"\"\n      \"44\": \"<\"\n      \"46\": \">\"\n      \"47\": \"?\"\n\n    htmlForNode = (n)->\n      if n.nodeType == n.TEXT_NODE then escapeHtml n.data\n      else n.outerHTML\n\n    export getEventChar = (e)->\n      if e.type == 'keypress' then String.fromCharCode eventChar e\n      else\n        c = (e.charCode || e.keyCode || e.which)\n        shifton = e.shiftKey || !!(e.modifiers & 4)\n        # normalize keyCode\n        if _to_ascii.hasOwnProperty(c) then c = _to_ascii[c]\n        if !shifton && (c >= 65 && c <= 90) then c = String.fromCharCode(c + 32)\n        else if e.shiftKey && shiftUps.hasOwnProperty(c)\n          # get shifted keyCode value\n          c = shiftUps[c]\n        else c = String.fromCharCode(c)\n        c\n\n    shiftKey = (c)-> 15 < c < 19\n\n    modifiers = (e, c)->\n      res = specialKeys[c] || String.fromCharCode(c)\n      if e.altKey then res = \"M-\" + res\n      if e.metaKey then res = \"M-\" + res\n      if e.ctrlKey then res = \"C-\" + res\n      if e.shiftKey then res = \"S-\" + res\n      res\n\n    export modifyingKey = (c, e)-> !e.altKey && !e.metaKey && !e.ctrlKey && (\n      (47 < c < 58)          || # number keys\n      c == 32 || c == ENTER  || # spacebar and enter\n      c == BS || c == DEL    || # backspace and delete\n      (64 < c < 91)          || # letter keys\n      (95 < c < 112)         || # numpad keys\n      (185 < c < 193)        || # ;=,-./` (in order)\n      (218 < c < 223)          # [\\]' (in order)\n      )\n\n    export last = (array)-> array.length && array[array.length - 1]\n\n    export posFor = (pos)->\n      if result = (if pos.pos == pos.node.length && pos.node.data[pos.pos - 1] == '\\n' && !(p = pos.save().next()).isEmpty() then p else pos).textPosition()\n        result.pos = p ? pos\n        result\n\n    replacements =\n      '<': \"&lt;\"\n      '>': \"&gt;\"\n      '&': \"&amp;\"\n\n    export escapeHtml = (str)->\n      if typeof str == 'string' then str.replace /[<>&]/g, (c)-> replacements[c]\n      else str\n\n    export findEditor = (node)->\n      target = $(node)\n      while target.length && !($(target).data().editor instanceof LeisureEditCore)\n        target = $(target).parent()\n      target.data()?.editor\n\n`preserveSelection` -- restore the current selection after func() completes.  This may\nwork better for you than LeisureEditCore.savePosition because it always preserves the\nselection, regardless of the current value of LeisureEditCore.editing.\n\n    preservingSelection = null\n\n    validatePositions = ->\n      node = (if $(document.activeElement).is 'input[input-number]'\n        document.activeElement\n      else\n        getSelection().anchorNode)\n      if editor = (node && findEditor node)\n        result = editor.options.validatePositions()\n        if result\n          console.error(\"DISCREPENCY AT POSITION #{result.block._id}, #{result.offset}\")\n\n    export preserveSelection = (func)->\n      if preservingSelection then func preservingSelection\n      else if $(document.activeElement).is 'input[input-number]'\n        num = document.activeElement.getAttribute 'input-number'\n        parentId = $(document.activeElement).closest('[data-view-block-name]').prop 'id'\n        input = document.activeElement\n        start = input.selectionStart\n        end = input.selectionEnd\n        try\n          func\n            type: 'None'\n            scrollTop: 0\n            scrollLeft: 0\n        finally\n          setTimeout(validatePositions, 1)\n          parent = $(\"##{parentId}\")\n          if input = parent.find(\"[input-number='#{num}']\")\n            input.selectionStart = start\n            input.selectionEnd = end\n            input.focus()\n      else if editor = findEditor getSelection().anchorNode\n        preservingSelection = editor.getSelectedDocRange()\n        try\n          func preservingSelection\n        finally\n          setTimeout(validatePositions, 1)\n          editor.selectDocRange preservingSelection\n          preservingSelection = null\n      else func\n        type: 'None'\n        scrollTop: 0\n        scrollLeft: 0\n\n    wrapDiag = (parent)-> (args...)->\n      r = parent.apply this, args\n      @diag()\n      r\n"
  ]
}